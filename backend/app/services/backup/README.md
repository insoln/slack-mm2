# backup/

Работа с файлами бэкапа Slack:
- zip_utils.py — работа с архивами (zip, подпапки)
- file_storage.py — временное и постоянное хранение файлов
- slack_parser.py — парсинг структур Slack, orchestrator импорта
- ... (другие сущности и обработчики)

В этом модуле не должно быть логики импорта/экспорта — только работа с файлами и парсинг.

## Импорт Slack-экспорта

- Для импорта используется функция `orchestrate_slack_import(zip_path)` из slack_parser.py.
- Пайплайн: распаковка архива → поиск users.json → парсинг пользователей → автосохранение маппингов User → очистка временных файлов.
- На данный момент поддерживается только импорт пользователей (users.json), остальные типы маппингов игнорируются.
- Все этапы логируются.

### Пример:
```python
await orchestrate_slack_import("/tmp/slack-backup-xxxx.zip")
```

## Пример использования

```python
from app.services.backup.file_storage import save_temp_file
save_temp_file(upload_file)
```

## Особенности распаковки архивов

- Для корректной работы с кириллическими именами файлов и папок архив Slack-экспорта всегда распаковывается через утилиту `unzip` с указанием кодировки UTF-8:
  ```bash
  unzip -O UTF-8 <архив.zip> -d <папка>
  ```
- Это реализовано в функции `extract_zip` (см. zip_utils.py). Если архив был создан в другой кодировке, используйте соответствующий параметр (`-O CP1251` и т.д.).
- Если распаковывать стандартным Python zipfile, имена папок с кириллицей могут быть повреждены (кракозябры), и такие сообщения не будут импортированы. 