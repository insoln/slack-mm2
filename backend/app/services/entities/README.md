# entities/

Парсинг и обработка сущностей:
- base_mixin.py — базовый класс BaseMapping с автосохранением и статусами
- user.py — сущность пользователя
- ... (другие сущности)

В этом модуле не должно быть логики экспорта — только парсинг и импорт в БД.

## Связь с БД и автосохранение

- Все сущности наследуют BaseMapping и автоматически сохраняются в универсальную таблицу Entity при создании (если не отключено параметром auto_save).
- Для статуса маппинга используется Enum MappingStatus (pending, skipped, failed, success), который хранится как ENUM в БД.

## Управление статусами

- Метод `set_status(new_status, error=None)` обновляет существующую запись в БД через SQL UPDATE
- При ошибке сохраняется `error_message` для диагностики
- Статусы обновляются асинхронно и не блокируют основной поток
- Поддерживается проверка результата обновления (`result.rowcount`)

## Особенности реализации

- При создании сущности проверяется существование по `entity_type` и `slack_id`
- Если сущность уже существует, возвращается существующая запись
- Обработка IntegrityError с повторным поиском для многопоточности
- Все операции логируются на уровне DEBUG для диагностики